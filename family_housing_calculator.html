<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>حاسبة السكن العائلي | التملك أم الاستمرار بالإيجار؟</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Bank/estate color palette
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            secondary: {
              50: '#f0fdf4',
              100: '#dcfce7',
              200: '#bbf7d0',
              300: '#86efac',
              400: '#4ade80',
              500: '#22c55e',
              600: '#16a34a',
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            },
            accent: {
              50: '#fffbeb',
              100: '#fef3c7',
              200: '#fde68a',
              300: '#fcd34d',
              400: '#fbbf24',
              500: '#f59e0b',
              600: '#d97706',
              700: '#b45309',
              800: '#92400e',
              900: '#78350f',
            },
            neutral: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <!-- Load Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <link rel="stylesheet" href="family_housing_calculator.css">
</head>
<body class="min-h-screen py-6 transition-colors duration-300">
  <div class="max-w-6xl mx-auto px-4">
    <!-- Header -->
    <div class="grid grid-cols-3 items-center mb-8">
      <!-- Back button (right side in RTL) -->
      <div class="flex justify-start">
        <a href="/" class="p-2 bg-primary-100 dark:bg-primary-900 rounded-full hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
          <i class="fas fa-arrow-right text-primary-600 dark:text-primary-300"></i>
        </a>
      </div>
      
      <!-- Title (centered) -->
      <div class="text-center">
        <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-secondary-600">حاسبة السكن العائلي</h1>
        <p class="text-neutral-600 dark:text-neutral-400">الاستمرار بالإيجار أم التملك مع نمو العائلة؟</p>
      </div>
      
      <!-- Dark mode toggle (left side in RTL) -->
      <div class="flex justify-end">
        <div class="relative inline-flex items-center">
          <label for="themeSwitch_field" class="sr-only">Toggle Dark Mode</label>
          <input type="checkbox" id="themeSwitch_field" class="sr-only">
          <div id="themeToggle" class="w-12 h-6 bg-neutral-200 dark:bg-neutral-700 rounded-full transition-colors duration-300 ease-in-out cursor-pointer relative">
            <div class="absolute inset-y-0 left-0 flex items-center pl-1.5 pointer-events-none">
              <i class="fas fa-moon text-primary-500 dark:text-primary-300 text-xs"></i>
            </div>
            <div class="absolute inset-y-0 right-0 flex items-center pr-1.5 pointer-events-none">
              <i class="fas fa-sun text-accent-500 text-xs"></i>
            </div>
            <div class="toggle-dot absolute inset-y-0.5 left-0.5 bg-white dark:bg-primary-600 w-5 h-5 rounded-full transition-transform duration-300 ease-in-out shadow-md"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="glass-card dark:glass-card-dark rounded-2xl overflow-hidden shadow-lg transition-all duration-300">
      <!-- Tabs -->
      <div class="flex border-b border-neutral-200 dark:border-neutral-700 bg-gradient-to-r from-primary-600 to-secondary-600 text-white">
        <button class="tab-btn py-4 px-6 font-medium opacity-80 hover:opacity-100 transition-opacity active" data-tab="calculator">
          <i class="fas fa-calculator ml-2"></i>الحاسبة
        </button>
        <button class="tab-btn py-4 px-6 font-medium opacity-80 hover:opacity-100 transition-opacity" data-tab="settings">
          <i class="fas fa-cog ml-2"></i>الإعدادات
        </button>
        <button class="tab-btn py-4 px-6 font-medium opacity-80 hover:opacity-100 transition-opacity" data-tab="about">
          <i class="fas fa-info-circle ml-2"></i>حول
        </button>
      </div>
      
      <!-- Calculator Tab -->
      <div id="calculator-tab" class="tab-content p-6 block">
        <form id="calcForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Current Situation Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-house-user ml-2"></i>الوضع الحالي
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="currentRent_field">
                    الإيجار الحالي السنوي (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">مبلغ الإيجار السنوي الذي تدفعه حالياً للمسكن. يساعد في مقارنة التكاليف وتقدير الزيادات المستقبلية.</span>
                    </span>
                  </label>
                  <input type="number" id="currentRent_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="1000" min="0" required>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="previousRent_field">
                    الإيجار قبل سنتين (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">مبلغ الإيجار الذي كنت تدفعه قبل سنتين. يساعد في حساب معدل زيادة الإيجار السنوي التاريخي الخاص بك.</span>
                    </span>
                  </label>
                  <input type="number" id="previousRent_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="1000" min="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="currentHome_field">
                    نوع السكن الحالي
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">نوع المسكن الذي تعيش فيه حالياً. يساعد في تقييم احتياجاتك السكنية مقارنة بالمستقبل.</span>
                    </span>
                  </label>
                  <select id="currentHome_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white">
                    <option value="apartment">شقة</option>
                    <option value="floor">دور</option>
                    <option value="villa">فيلا</option>
                    <option value="other">أخرى</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="currentArea_field">
                    مساحة السكن الحالي (متر مربع)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المساحة الكلية للمسكن الحالي. تساعد في مقارنة المساحة الحالية مع احتياجات العائلة المستقبلية.</span>
                    </span>
                  </label>
                  <input type="number" id="currentArea_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10" min="0">
                </div>
              </div>
            </div>
            
            <!-- Family Situation Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-users ml-2"></i>الوضع العائلي
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="currentFamilySize_field">
                    عدد أفراد العائلة الحالي
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">عدد أفراد العائلة الذين يعيشون معك حالياً. يساعد في تقدير احتياجات المساحة الحالية والمستقبلية.</span>
                    </span>
                  </label>
                  <input type="number" id="currentFamilySize_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="1" required>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="plannedChildren_field">
                    عدد الأطفال المخطط إنجابهم مستقبلاً
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">عدد الأطفال الذين تخطط لإنجابهم في المستقبل. يساعد في توقع النمو العائلي وتأثيره على احتياجات السكن.</span>
                    </span>
                  </label>
                  <input type="number" id="plannedChildren_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="yearsUntilChildrenGrowUp_field">
                    عدد السنوات حتى يكبر الأطفال (ويحتاجون غرف منفصلة)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">تقدير للوقت حتى يحتاج الأطفال لغرف منفصلة. مهم لتحديد توقيت الحاجة للانتقال لمسكن أكبر.</span>
                    </span>
                  </label>
                  <input type="number" id="yearsUntilChildrenGrowUp_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0">
                </div>
                
                <!-- REPLACED: Split the expected stay years into two fields -->
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="expectedStayYears_buy_field">
                    مدة البقاء المتوقعة في المسكن المشتري (سنوات)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المدة التي تتوقع فيها البقاء في المسكن المشتري. تؤثر على حسابات القيمة المستقبلية وعائد الاستثمار.</span>
                    </span>
                  </label>
                  <input type="number" id="expectedStayYears_buy_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="1" required value="15">
                </div>

                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="expectedStayYears_rent_field">
                    مدة البقاء المتوقعة في المسكن المستأجر (سنوات)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المدة التي تتوقع فيها البقاء في المسكن المستأجر. قد تختلف عن مدة البقاء في حالة الشراء.</span>
                    </span>
                  </label>
                  <input type="number" id="expectedStayYears_rent_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="1" required value="5">
                </div>
              </div>
            </div>
            
            <!-- NEW: Income Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-money-bill-wave ml-2"></i>معلومات الدخل
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="monthlyIncome_field">
                    الدخل الشهري (ريال)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">إجمالي الدخل الشهري بعد الضرائب.</span>
                    </span>
                  </label>
                  <input type="number" id="monthlyIncome_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" required value="15000">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="additionalIncome_field">
                    دخل إضافي شهري (ريال)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">أي دخل إضافي شهري مثل العقارات المؤجرة أو الاستثمارات.</span>
                    </span>
                  </label>
                  <input type="number" id="additionalIncome_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="0">
                </div>
              </div>
            </div>
            
            <!-- NEW: Liabilities Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-credit-card ml-2"></i>الالتزامات المالية
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="monthlyDebt_field">
                    مدفوعات الديون الشهرية (ريال)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">إجمالي المدفوعات الشهرية للقروض والديون (عدا الإيجار أو الرهن العقاري).</span>
                    </span>
                  </label>
                  <input type="number" id="monthlyDebt_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="monthlyExpenses_field">
                    مصاريف شهرية أخرى (ريال)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المصاريف الشهرية الأخرى مثل فواتير المرافق، الطعام، النقل، الخ.</span>
                    </span>
                  </label>
                  <input type="number" id="monthlyExpenses_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="5000">
                </div>
              </div>
            </div>
            
            <!-- Purchase Options Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-home ml-2"></i>خيارات التملك
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="purchaseType_field">
                    نوع العقار المراد تملكه
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">نوع العقار الذي ترغب بتملكه. يؤثر على التكلفة الأولية وتكاليف الصيانة المستقبلية.</span>
                    </span>
                  </label>
                  <select id="purchaseType_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white">
                    <option value="apartment">شقة</option>
                    <option value="floor">دور</option>
                    <option value="villa">فيلا</option>
                    <option value="land_and_build">أرض وبناء</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="purchasePrice_field">
                    سعر العقار المتوقع (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">السعر المتوقع للعقار الذي ترغب بشرائه. من أهم البيانات للمقارنة بين الإيجار والتملك.</span>
                    </span>
                  </label>
                  <input type="number" id="purchasePrice_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10000" min="0" required>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="purchaseArea_field">
                    مساحة العقار المراد تملكه (متر مربع)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المساحة الكلية للعقار المراد شراؤه. تساعد في تقييم ملاءمة العقار لاحتياجات العائلة وفي مقارنة سعر المتر.</span>
                    </span>
                  </label>
                  <input type="number" id="purchaseArea_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10" min="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="propertyLocation_field">
                    المنطقة
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">موقع العقار المراد شراؤه. يؤثر على تقديرات ارتفاع قيمة العقار ومعدلات الإيجار المستقبلية.</span>
                    </span>
                  </label>
                  <select id="propertyLocation_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white">
                    <option value="riyadh">الرياض</option>
                    <option value="jeddah">جدة</option>
                    <option value="dammam">الدمام</option>
                    <option value="makkah">مكة</option>
                    <option value="madinah">المدينة</option>
                    <option value="other">مدينة أخرى</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Financing Options Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-money-bill-wave ml-2"></i>خيارات التمويل
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="downPayment_field">
                    الدفعة المقدمة (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المبلغ الذي ستدفعه مقدماً عند شراء العقار. كلما زادت الدفعة المقدمة، قلت تكلفة التمويل الإجمالية.</span>
                    </span>
                  </label>
                  <input type="number" id="downPayment_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10000" min="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="downPaymentPercent_field">
                    الدفعة المقدمة (% من سعر العقار)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">نسبة الدفعة المقدمة من السعر الإجمالي. عادة تكون 20% أو أكثر للحصول على شروط تمويل أفضل.</span>
                    </span>
                  </label>
                  <input type="number" id="downPaymentPercent_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="1" min="0" max="100" value="20">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="mortgageInterest_field">
                    معدل فائدة التمويل (%)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">معدل الفائدة السنوي على القرض العقاري. يؤثر بشكل كبير على التكلفة الإجمالية للتملك.</span>
                    </span>
                  </label>
                  <input type="number" id="mortgageInterest_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="0.1" min="0" value="3.5">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="mortgageTerm_field">
                    مدة التمويل (سنوات)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">مدة سداد القرض العقاري. زيادة المدة تخفض القسط الشهري لكنها تزيد التكلفة الإجمالية للتمويل.</span>
                    </span>
                  </label>
                  <input type="number" id="mortgageTerm_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="1" max="30" value="25">
                </div>
              </div>
            </div>
            
            <!-- Future Housing Needs Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-chart-line ml-2"></i>احتياجات السكن المستقبلية
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="futureSizeNeeded_field">
                    المساحة المطلوبة مستقبلاً (متر مربع)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">المساحة المقدرة التي ستحتاجها العائلة مستقبلاً. تُحسب تلقائياً بناءً على نمو العائلة المتوقع.</span>
                    </span>
                  </label>
                  <input type="number" id="futureSizeNeeded_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10" min="0">
                  <p class="mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                    سيتم حسابها تلقائياً بناء على نمو العائلة (أو يمكنك تعديلها)
                  </p>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="futureUpgradeYear_field">
                    سنة الانتقال إلى مسكن أكبر
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">السنة التي تتوقع فيها الانتقال إلى مسكن أكبر. مهمة لحساب تكاليف البيع والشراء وتغير التمويل.</span>
                    </span>
                  </label>
                  <input type="number" id="futureUpgradeYear_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0">
                  <p class="mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                    سيتم تحديدها تلقائياً بناء على مؤشر نمو العائلة
                  </p>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="futureHomeCost_field">
                    التكلفة المتوقعة للمسكن المستقبلي (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">تقدير لتكلفة المسكن الأكبر في المستقبل. تُحسب تلقائياً بناءً على المساحة المطلوبة وأسعار السوق.</span>
                    </span>
                  </label>
                  <input type="number" id="futureHomeCost_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="10000" min="0">
                  <p class="mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                    سيتم تقديرها بناءً على أسعار السوق وحجم المسكن المطلوب
                  </p>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="futureRentCost_field">
                    تكلفة إيجار المسكن المستقبلي (﷼ سنوياً)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">تقدير للإيجار السنوي للمسكن الأكبر. يُحسب تلقائياً بناءً على قيمة العقار ومتوسط عائد الإيجار.</span>
                    </span>
                  </label>
                  <input type="number" id="futureRentCost_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="1000" min="0">
                  <p class="mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                    سيتم تقديرها بناءً على متوسطات الإيجار وحجم المسكن المطلوب
                  </p>
                </div>
              </div>
            </div>
            
            <!-- Additional Costs Section -->
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">
                <i class="fas fa-coins ml-2"></i>تكاليف إضافية
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="maintenanceCost_field">
                    تكاليف الصيانة السنوية (% من قيمة العقار)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">النسبة المئوية من قيمة العقار التي تُدفع سنوياً للصيانة. تتراوح عادة بين 0.5% إلى 2%.</span>
                    </span>
                  </label>
                  <input type="number" id="maintenanceCost_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" step="0.1" min="0" value="1">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="propertyTax_field">
                    الضرائب العقارية السنوية (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">أي ضرائب أو رسوم حكومية سنوية مرتبطة بملكية العقار.</span>
                    </span>
                  </label>
                  <input type="number" id="propertyTax_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="0">
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="utilityDifference_field">
                    الفرق في فواتير الخدمات الشهرية (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">الفرق الشهري في تكاليف الكهرباء والماء بين المسكن المملوك والمستأجر.</span>
                    </span>
                  </label>
                  <input type="number" id="utilityDifference_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="0">
                  <p class="mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                    الفرق بين فواتير المسكن الملك والإيجار (كهرباء، ماء، إلخ)
                  </p>
                </div>
                
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2" for="movingCost_field">
                    تكلفة الانتقال (﷼)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">تكلفة نقل الأثاث والانتقال من مسكن لآخر. يتم تطبيقها عند الانتقال الأولي وعند الترقية للمسكن الأكبر.</span>
                    </span>
                  </label>
                  <input type="number" id="movingCost_field" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" min="0" value="5000">
                </div>
              </div>
            </div>
            
            <div class="col-span-full">
              <button type="button" id="calculateBtn" class="w-full bg-gradient-to-r from-primary-600 to-secondary-600 text-white px-6 py-3 rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors shadow-md">
                <i class="fas fa-calculator ml-2"></i>احسب الخيار الأفضل لعائلتي
              </button>
            </div>
          </div>
        </form>
        
        <!-- Results Section -->
        <div id="results" class="mt-8 hidden">
          <h2 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-4">نتائج المقارنة لعائلتك</h2>
          
          <!-- NEW: Affordability Results Section -->
          <div id="affordabilityResults" class="mb-8 bg-white dark:bg-neutral-800 rounded-xl shadow overflow-hidden">
            <div class="bg-neutral-50 dark:bg-neutral-700 px-6 py-4">
              <h3 class="font-bold text-neutral-800 dark:text-neutral-200">تحليل القدرة المالية</h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
                  <h4 class="font-bold mb-2">القدرة على تحمل تكاليف الشراء</h4>
                  <div id="mortgageAffordability" class="text-lg"></div>
                  <div id="affordableHomePrice" class="mt-2"></div>
                </div>
                
                <div class="p-4 bg-neutral-50 dark:bg-neutral-800 rounded-lg">
                  <h4 class="font-bold mb-2">القدرة على تحمل تكاليف الإيجار</h4>
                  <div id="rentAffordability" class="text-lg"></div>
                  <div id="recommendedRent" class="mt-2"></div>
                </div>
                
                <div class="p-4 bg-neutral-50 dark:bg-neutral-800 rounded-lg col-span-1 md:col-span-2">
                  <h4 class="font-bold mb-2">ملخص الوضع المالي</h4>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <p class="text-sm text-neutral-600 dark:text-neutral-400">إجمالي الدخل الشهري</p>
                      <p id="totalIncomeDisplay" class="text-lg font-bold"></p>
                    </div>
                    <div>
                      <p class="text-sm text-neutral-600 dark:text-neutral-400">نسبة الدين إلى الدخل</p>
                      <p id="dtiRatioDisplay" class="text-lg font-bold"></p>
                    </div>
                    <div>
                      <p class="text-sm text-neutral-600 dark:text-neutral-400">الحد الأقصى المستحسن للسكن</p>
                      <p id="maxHousingDisplay" class="text-lg font-bold"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Summary Cards -->
          <div class="flex flex-wrap gap-4 mb-6">
            <div class="flex-1 min-w-[200px] bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-900/30 dark:to-primary-800/30 rounded-lg p-4 shadow-sm">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-neutral-500 dark:text-neutral-400 text-sm">إجمالي تكلفة التملك</p>
                  <p id="totalOwnership_result" class="text-2xl font-bold text-neutral-800 dark:text-white"></p>
                </div>
                <div class="p-3 bg-primary-100 dark:bg-primary-800/50 rounded-full">
                    <i class="fas fa-home text-primary-600 dark:text-primary-300"></i>
                  </div>
                </div>
              </div>
              
              <div class="flex-1 min-w-[200px] bg-gradient-to-br from-accent-50 to-accent-100 dark:from-accent-900/30 dark:to-accent-800/30 rounded-lg p-4 shadow-sm">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="text-neutral-500 dark:text-neutral-400 text-sm">إجمالي تكلفة الإيجار</p>
                    <p id="totalRent_result" class="text-2xl font-bold text-neutral-800 dark:text-white"></p>
                  </div>
                  <div class="p-3 bg-accent-100 dark:bg-accent-800/50 rounded-full">
                    <i class="fas fa-file-invoice-dollar text-accent-600 dark:text-accent-300"></i>
                  </div>
                </div>
              </div>
              
              <div class="flex-1 min-w-[200px] bg-gradient-to-br from-secondary-50 to-secondary-100 dark:from-secondary-900/30 dark:to-secondary-800/30 rounded-lg p-4 shadow-sm">
                <div class="flex justify-between items-center">
                  <div>
                    <p class="text-neutral-500 dark:text-neutral-400 text-sm">الخيار الأوفر مالياً</p>
                    <p id="betterOption_result" class="text-2xl font-bold text-neutral-800 dark:text-white"></p>
                  </div>
                  <div class="p-3 bg-secondary-100 dark:bg-secondary-800/50 rounded-full">
                    <i class="fas fa-check-circle text-secondary-600 dark:text-secondary-300"></i>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Family Growth Insight Box -->
            <div id="familyInsight" class="mb-8 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg border-r-4 border-primary-500">
              <div class="flex items-start">
                <div class="p-2 bg-primary-100 dark:bg-primary-800/50 rounded-full mr-3 mt-1">
                  <i class="fas fa-users text-primary-600 dark:text-primary-300"></i>
                </div>
                <div>
                  <h3 class="font-bold text-primary-800 dark:text-primary-300 mb-1">تحليل احتياجات نمو العائلة</h3>
                  <p id="familyInsight_text" class="text-neutral-700 dark:text-neutral-300"></p>
                </div>
              </div>
            </div>
            
            <!-- Recommendation Box -->
            <div id="recommendation" class="mb-8 p-4 bg-secondary-50 dark:bg-secondary-900/20 rounded-lg border-r-4 border-secondary-500">
              <div class="flex items-start">
                <div class="p-2 bg-secondary-100 dark:bg-secondary-800/50 rounded-full mr-3 mt-1">
                  <i class="fas fa-lightbulb text-secondary-600 dark:text-secondary-300"></i>
                </div>
                <div>
                  <h3 class="font-bold text-secondary-800 dark:text-secondary-300 mb-1">التوصية</h3>
                  <p id="recommendation_text" class="text-neutral-700 dark:text-neutral-300"></p>
                </div>
              </div>
            </div>
            
            <!-- Timeline of Events -->
            <div class="bg-white dark:bg-neutral-800 rounded-xl shadow overflow-hidden mb-8">
              <div class="bg-neutral-50 dark:bg-neutral-700 px-6 py-4">
                <h3 class="font-bold text-neutral-800 dark:text-neutral-200">الجدول الزمني للأحداث</h3>
              </div>
              <div class="p-6">
                <div class="relative">
                  <!-- Timeline bar -->
                  <div class="absolute h-full w-1 bg-primary-200 dark:bg-primary-900 left-7 ml-0.5"></div>
                  
                  <div id="timelineEvents" class="space-y-8 relative">
                    <!-- Timeline entries will be added here by JavaScript -->
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Comparison Table -->
            <div class="bg-white dark:bg-neutral-800 rounded-xl shadow overflow-hidden mb-8">
              <div class="bg-neutral-50 dark:bg-neutral-700 px-6 py-4">
                <h3 class="font-bold text-neutral-800 dark:text-neutral-200">مقارنة تفصيلية</h3>
              </div>
              <div class="p-6">
                <div class="overflow-x-auto">
                  <table class="w-full text-right">
                    <thead>
                      <tr class="text-neutral-600 dark:text-neutral-300 border-b dark:border-neutral-700">
                        <th class="pb-3 font-medium">البند</th>
                        <th class="pb-3 font-medium">التملك</th>
                        <th class="pb-3 font-medium">الإيجار</th>
                      </tr>
                    </thead>
                    <tbody class="text-neutral-700 dark:text-neutral-300">
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">التكلفة الشهرية الأولية</td>
                        <td id="initialMonthlyOwnership_result"></td>
                        <td id="initialMonthlyRent_result"></td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">إجمالي التكلفة (الفترة الأولى)</td>
                        <td id="initialPhaseOwnership_result"></td>
                        <td id="initialPhaseRent_result"></td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">تكلفة الانتقال للمسكن الأكبر</td>
                        <td id="upgradeCostOwnership_result"></td>
                        <td id="upgradeCostRent_result"></td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">التكلفة الشهرية بعد الانتقال</td>
                        <td id="laterMonthlyOwnership_result"></td>
                        <td id="laterMonthlyRent_result"></td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">إجمالي التكلفة (الفترة اللاحقة)</td>
                        <td id="laterPhaseOwnership_result"></td>
                        <td id="laterPhaseRent_result"></td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">تكاليف الصيانة الإجمالية</td>
                        <td id="maintenanceCosts_result"></td>
                        <td>-</td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700">
                        <td class="py-3">تكاليف التمويل الإجمالية</td>
                        <td id="financingCosts_result"></td>
                        <td>-</td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700 bg-secondary-50 dark:bg-secondary-900/20">
                        <td class="py-3 font-bold">قيمة الأصول المملوكة في نهاية المدة</td>
                        <td id="finalPropertyValue_result" class="font-bold text-secondary-600 dark:text-secondary-400"></td>
                        <td>0</td>
                      </tr>
                      <tr class="border-b dark:border-neutral-700 bg-primary-50 dark:bg-primary-900/20">
                        <td class="py-3 font-bold">الرصيد المتبقي من القرض</td>
                        <td id="remainingMortgage_result" class="font-bold text-neutral-600 dark:text-neutral-400"></td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td class="py-3 font-bold">صافي التكلفة بعد خصم قيمة الأصول</td>
                        <td id="netOwnership_result" class="font-bold text-primary-600 dark:text-primary-400"></td>
                        <td id="netRent_result" class="font-bold text-accent-600 dark:text-accent-400"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Charts Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <!-- Costs Chart -->
              <div class="bg-white dark:bg-neutral-800 p-4 rounded-xl shadow">
                <h3 class="font-bold text-neutral-700 dark:text-neutral-300 mb-4">تطور التكاليف على مدار السنوات</h3>
                <div class="h-64 flex items-center justify-center">
                  <canvas id="costsChart"></canvas>
                </div>
              </div>
              
              <!-- Cumulative Costs Chart -->
              <div class="bg-white dark:bg-neutral-800 p-4 rounded-xl shadow">
                <h3 class="font-bold text-neutral-700 dark:text-neutral-300 mb-4">التكاليف التراكمية مع الوقت</h3>
                <div class="h-64 flex items-center justify-center">
                  <canvas id="cumulativeChart"></canvas>
                </div>
              </div>
            </div>
            
            <!-- Family Size Projection Chart -->
            <div class="bg-white dark:bg-neutral-800 p-4 rounded-xl shadow mb-8">
              <h3 class="font-bold text-neutral-700 dark:text-neutral-300 mb-4">توقع نمو حجم العائلة والمساحة المطلوبة</h3>
              <div class="h-64 flex items-center justify-center">
                <canvas id="familySizeChart"></canvas>
              </div>
            </div>
            <div id="finalInsight_text" class="mt-4 p-3 bg-accent-50 dark:bg-accent-900/20 text-neutral-700 dark:text-neutral-300 rounded-lg border-r-4 border-accent-500"></div>

            <button id="addFinalTimelineEntry" class="mt-4 bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-lg">
                <i class="fas fa-plus-circle mr-2"></i>إضافة نتيجة نهائية إلى الجدول الزمني
              </button>
          </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content p-6 hidden">
          <h2 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-6">إعدادات الحاسبة</h2>
          
          <div class="space-y-6">
            <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">معاملات الاحتساب</h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                    معدل التضخم السنوي (%)
                    <span class="tooltip">
                      <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                      <span class="tooltiptext">معدل ارتفاع الأسعار العام في الاقتصاد. يؤثر على تكاليف الصيانة والانتقال.</span>
                    </span>
                  </label>
                  <input type="number" id="inflationRate" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="2.5" min="0" max="20" step="0.1">
              </div>
              
              <div>
                <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                  معدل ارتفاع الإيجارات السنوي (%)
                  <span class="tooltip">
                    <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                    <span class="tooltiptext">المعدل السنوي لزيادة الإيجارات. يؤثر بشكل كبير على تكلفة الإيجار طويلة المدى.</span>
                  </span>
                </label>
                <input type="number" id="rentIncreaseRate" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="3" min="0" max="20" step="0.1">
              </div>
              
              <div>
                <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                  معدل ارتفاع قيمة العقارات السنوي (%)
                  <span class="tooltip">
                    <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                    <span class="tooltiptext">معدل ارتفاع قيمة العقارات سنوياً. يؤثر على القيمة المستقبلية للعقار المملوك.</span>
                  </span>
                </label>
                <input type="number" id="propertyAppreciationRate" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="3.5" min="0" max="20" step="0.1">
              </div>
            </div>
          </div>
          
          <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg mt-6">
            <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">معاملات حساب المساحة</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                  المساحة الأساسية لشخصين (متر مربع)
                  <span class="tooltip">
                    <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                    <span class="tooltiptext">المساحة الأساسية المطلوبة لشخصين بالغين (زوجين). تمثل أساس حساب المساحة العائلية.</span>
                  </span>
                </label>
                <input type="number" id="baseSqmForTwo" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="100" min="0" step="10">
              </div>
              
              <div>
                <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                  المساحة الإضافية لكل طفل صغير (متر مربع)
                  <span class="tooltip">
                    <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                    <span class="tooltiptext">المساحة الإضافية المطلوبة لكل طفل قبل سن الاحتياج لغرفة منفصلة.</span>
                  </span>
                </label>
                <input type="number" id="additionalSqmPerSmallChild" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="15" min="0" step="5">
            </div>
            
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                المساحة الإضافية لكل طفل كبير (متر مربع)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">المساحة الإضافية المطلوبة لكل طفل بعد سن الاحتياج لغرفة منفصلة.</span>
                </span>
              </label>
              <input type="number" id="additionalSqmPerBigChild" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="25" min="0" step="5">
            </div>
          </div>
        </div>
        
        <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg mt-6">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">تكاليف إضافية</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                تكاليف البيع (% من قيمة العقار)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">النسبة المئوية من قيمة العقار التي تُدفع كمصاريف عند بيعه (سعي، رسوم...).</span>
                </span>
              </label>
              <input type="number" id="sellingCostsRate" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="2.5" min="0" max="10" step="0.1">
            </div>
            
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                تكاليف الشراء (% من قيمة العقار)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">النسبة المئوية من قيمة العقار التي تُدفع كمصاريف عند شرائه (سعي، رسوم، صكوك...).</span>
                </span>
              </label>
              <input type="number" id="purchaseCostsRate" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="2" min="0" max="10" step="0.1">
            </div>
            
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                متوسط سعر المتر المربع للمسكن (﷼)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">متوسط سعر المتر المربع للمساكن في المنطقة. يستخدم لتقدير تكلفة المسكن المستقبلي.</span>
                </span>
              </label>
              <input type="number" id="averageSqmPrice" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="5000" min="0" step="100">
            </div>
          </div>
        </div>
        
        <!-- NEW: Financial Affordability Settings -->
        <div class="bg-neutral-50 dark:bg-neutral-800 p-4 rounded-lg mt-6">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">معاملات القدرة المالية</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                نسبة الدين المستحسنة (% من الدخل)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">النسبة القصوى المستحسنة للدفعات الشهرية للديون من إجمالي الدخل.</span>
                </span>
              </label>
              <input type="number" id="recommendedDtiRatio" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="36" min="0" max="100" step="1">
            </div>
            
            <div>
              <label class="block text-neutral-700 dark:text-neutral-300 font-medium mb-2">
                نسبة السكن المستحسنة (% من الدخل)
                <span class="tooltip">
                  <i class="fas fa-question-circle text-xs text-primary-500 mr-1 help-icon"></i>
                  <span class="tooltiptext">النسبة القصوى المستحسنة لمصاريف السكن من إجمالي الدخل.</span>
                </span>
              </label>
              <input type="number" id="recommendedHousingRatio" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-700 dark:border-neutral-600 dark:text-white" value="28" min="0" max="100" step="1">
            </div>
          </div>
        </div>
        
        <button id="saveSettings" class="w-full bg-gradient-to-r from-primary-600 to-secondary-600 text-white px-6 py-3 rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors shadow-md mt-6">
          <i class="fas fa-save ml-2"></i>حفظ الإعدادات
        </button>
      </div>
    </div>
    
    <!-- About Tab -->
    <div id="about-tab" class="tab-content p-6 hidden">
      <h2 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-6">حول حاسبة السكن العائلي</h2>
      
      <div class="space-y-6">
        <div class="bg-neutral-50 dark:bg-neutral-800 p-6 rounded-lg">
          <p class="text-neutral-700 dark:text-neutral-300 mb-4">
            حاسبة السكن العائلي هي أداة مصممة لمساعدتك في اتخاذ قرار مالي أفضل بخصوص سكن عائلتك مع الأخذ بعين الاعتبار النمو المتوقع لعائلتك والاحتياجات المستقبلية. تقوم الحاسبة بتحليل:
          </p>
          <ul class="list-disc list-inside space-y-2 text-neutral-700 dark:text-neutral-300">
            <li>التكلفة الإجمالية لتملك العقار مقابل الاستمرار بالإيجار</li>
            <li>التكاليف الإضافية للانتقال إلى سكن أكبر في المستقبل عند نمو العائلة</li>
            <li>معدلات زيادة الإيجار المتوقعة بناءً على البيانات التاريخية</li>
            <li>تكاليف الصيانة والتمويل على مدى سنوات</li>
            <li>القيمة المستقبلية للعقارات المملوكة</li>
            <li>التأثير المالي لنمو العائلة على احتياجات السكن</li>
            <li>تحليل القدرة المالية وتوافق التكاليف مع دخلك</li>
          </ul>
        </div>
        
        <div class="bg-neutral-50 dark:bg-neutral-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">كيفية استخدام الحاسبة</h3>
          <ol class="list-decimal list-inside space-y-2 text-neutral-700 dark:text-neutral-300">
            <li>أدخل معلومات وضعك الحالي (الإيجار الحالي، نوع السكن)</li>
            <li>أدخل معلومات عائلتك وخططها (عدد الأفراد الحالي، الأطفال المستقبليين)</li>
            <li>أدخل معلومات دخلك والتزاماتك المالية الحالية</li>
            <li>أدخل معلومات العقار الذي تفكر بشرائه وخيارات التمويل</li>
            <li>راجع احتياجات السكن المستقبلية المقترحة (أو عدلها)</li>
            <li>اضغط على زر "احسب الخيار الأفضل لعائلتي" لعرض النتائج</li>
            <li>اطلع على التحليل المفصل والتوصيات المناسبة لوضع عائلتك</li>
          </ol>
        </div>
        
        <div class="bg-neutral-50 dark:bg-neutral-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">ملاحظات هامة</h3>
          <ul class="list-disc list-inside space-y-2 text-neutral-700 dark:text-neutral-300">
            <li>هذه الحاسبة أداة تقديرية لمساعدتك في اتخاذ القرار</li>
            <li>النتائج تعتمد على دقة البيانات المدخلة والتوقعات المستقبلية</li>
            <li>التعديلات في حجم العائلة واحتياجاتها قد تختلف من أسرة لأخرى</li>
            <li>استشر مختصاً مالياً أو عقارياً قبل اتخاذ قرارات مالية كبيرة</li>
            <li>الظروف الاقتصادية والمالية قد تتغير مع الوقت، لذا من المفيد إعادة التقييم دورياً</li>
            <li>تقديرات القدرة المالية تستند إلى معايير مالية عامة وقد تختلف حسب البنك أو المؤسسة المالية</li>
          </ul>
        </div>
        
        <div class="bg-neutral-50 dark:bg-neutral-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">تواصل معي</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="https://twitter.com/abutlb" target="_blank" class="flex items-center p-4 bg-white dark:bg-neutral-700 rounded-lg hover:shadow-md transition-shadow">
              <div class="p-2 rounded-full bg-primary-50 dark:bg-primary-900/30">
                <i class="fab fa-twitter text-primary-400"></i>
              </div>
              <span class="mr-3 text-neutral-700 dark:text-neutral-300">@abutlb</span>
            </a>
            
            <a href="https://www.linkedin.com/in/abdullah-altwijri-b053b1234/" target="_blank" class="flex items-center p-4 bg-white dark:bg-neutral-700 rounded-lg hover:shadow-md transition-shadow">
              <div class="p-2 rounded-full bg-primary-50 dark:bg-primary-900/30">
                <i class="fab fa-linkedin-in text-primary-700"></i>
              </div>
              <span class="mr-3 text-neutral-700 dark:text-neutral-300">LinkedIn</span>
            </a>
            
            <a href="https://github.com/abutlb" target="_blank" class="flex items-center p-4 bg-white dark:bg-neutral-700 rounded-lg hover:shadow-md transition-shadow">
              <div class="p-2 rounded-full bg-neutral-50 dark:bg-neutral-800">
                <i class="fab fa-github text-neutral-700 dark:text-white"></i>
              </div>
              <span class="mr-3 text-neutral-700 dark:text-neutral-300">GitHub</span>
            </a>
            
            <a href="mailto:abutlb10015@gmail.com" class="flex items-center p-4 bg-white dark:bg-neutral-700 rounded-lg hover:shadow-md transition-shadow">
              <div class="p-2 rounded-full bg-accent-50 dark:bg-accent-900/30">
                <i class="fas fa-envelope text-accent-500"></i>
              </div>
              <span class="mr-3 text-neutral-700 dark:text-neutral-300">Email</span>
            </a>
          </div>
        </div>
        
        <!-- Version Info -->
        <div class="bg-neutral-50 dark:bg-neutral-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-primary-600 dark:text-primary-400">معلومات الإصدار</h3>
          <p class="text-neutral-700 dark:text-neutral-300">الإصدار الحالي: <span class="font-semibold">2.0.0</span></p>
          <p class="text-neutral-700 dark:text-neutral-300">آخر تحديث: <span id="lastUpdated">مارس 2024</span></p>
          <p class="text-neutral-700 dark:text-neutral-300 mt-2">تم تحديث الحاسبة مع إضافة:</p>
          <ul class="list-disc list-inside space-y-1 text-neutral-700 dark:text-neutral-300 mt-1">
            <li>تحليل القدرة المالية وحساب القدرة على تحمل التكاليف</li>
            <li>تحسينات في واجهة المستخدم وتجربة الاستخدام</li>
            <li>فصل مدة البقاء المتوقعة بين التملك والإيجار</li>
            <li>إضافة أقسام للدخل والالتزامات المالية</li>
            <li>توضيحات وشرح لكل حقل من حقول الإدخال</li>
            <li>تحسين خوارزميات التوقع المالي والعقاري</li>
            <li>إضافة مؤشرات إضافية في تحليل النتائج</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="mt-12 text-center text-neutral-500 dark:text-neutral-400 text-sm">        
    <p>© <span id="currentYear">2024</span> - تم التطوير بواسطة عبدالله التويجري</p>
    <p class="mt-1">جميع التحليلات والتوصيات تقريبية وتهدف للمساعدة في اتخاذ القرار فقط</p>
  </footer>
</div>

<script src="family_housing_calculator.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة الصحة الشاملة الاحترافية | عبدالله التويجري</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                        },
                        accent: {
                            500: '#f59e0b',
                            600: '#d97706',
                        },
                        health: {
                            excellent: '#22c55e',
                            good: '#84cc16',
                            fair: '#eab308',
                            poor: '#f97316',
                            critical: '#ef4444',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-gentle': 'pulseGentle 2s ease-in-out infinite',
                        'bounce-gentle': 'bounceGentle 3s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulseGentle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes bounceGentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-effect-dark {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(30, 41, 59, 0.3);
        }
        
        .gradient-border {
            background: linear-gradient(90deg, #0ea5e9, #22c55e, #f59e0b) padding-box,
                        linear-gradient(90deg, #0ea5e9, #22c55e, #f59e0b) border-box;
            border: 2px solid transparent;
        }
        
        .health-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .health-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.3);
        }
        
        .progress-ring {
            transition: stroke-dasharray 0.5s ease-in-out;
        }
        
        .floating-element {
            animation: bounceGentle 4s ease-in-out infinite;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Range input styling */
        .range-input {
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #0ea5e9, #22c55e);
            height: 6px;
            border-radius: 3px;
            outline: none;
        }
        
        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0ea5e9;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        /* Health status indicators */
        .status-excellent { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .status-good { background: linear-gradient(135deg, #84cc16, #65a30d); }
        .status-fair { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .status-poor { background: linear-gradient(135deg, #f97316, #ea580c); }
        .status-critical { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Tooltip styling */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .glass-effect, .glass-effect-dark { 
                background: white !important; 
                backdrop-filter: none !important;
                border: 1px solid #e2e8f0 !important;
            }
            body { 
                background: white !important; 
                color: black !important;
                font-size: 12px !important;
                line-height: 1.3 !important;
            }
            .max-w-7xl { max-width: 100% !important; }
            .px-4, .px-6 { padding-left: 8px !important; padding-right: 8px !important; }
            .py-6, .py-4 { padding-top: 4px !important; padding-bottom: 4px !important; }
            .text-3xl { font-size: 18px !important; }
            .text-xl { font-size: 16px !important; }
            .text-lg { font-size: 14px !important; }
            .grid { display: block !important; }
            .space-y-6 > * + *, .space-y-4 > * + *, .space-y-3 > * + * { 
                margin-top: 8px !important; 
            }
            .mb-8, .mb-6 { margin-bottom: 8px !important; }
            .p-6 { padding: 8px !important; }
            .rounded-xl, .rounded-lg { border-radius: 4px !important; }
            #progressSection { display: none !important; }
            .floating-element { display: none !important; }
            header { margin-bottom: 12px !important; }
            footer { margin-top: 12px !important; }
            .lg\:col-span-1, .lg\:col-span-2 { display: block !important; width: 100% !important; }
            .md\:grid-cols-2, .md\:grid-cols-4 { grid-template-columns: repeat(2, 1fr) !important; }
        }
    </style>
</head>

<body class="font-tajawal bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 min-h-screen transition-all duration-500">
    
    <!-- Floating Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-20 w-32 h-32 bg-blue-200 dark:bg-blue-800 rounded-full opacity-20 floating-element"></div>
        <div class="absolute top-1/2 right-20 w-24 h-24 bg-green-200 dark:bg-green-800 rounded-full opacity-20 floating-element" style="animation-delay: 1s;"></div>
        <div class="absolute bottom-20 left-1/3 w-28 h-28 bg-yellow-200 dark:bg-yellow-800 rounded-full opacity-20 floating-element" style="animation-delay: 2s;"></div>
    </div>
    
    <!-- Header -->
    <header class="relative z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <!-- Navigation -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <a href="index.html" 
                       class="group flex items-center space-x-2 space-x-reverse px-4 py-2 bg-white/20 dark:bg-slate-800/50 backdrop-blur-sm rounded-xl border border-white/30 dark:border-slate-700/50 hover:bg-white/30 dark:hover:bg-slate-700/50 transition-all duration-300">
                        <i class="fas fa-arrow-right text-slate-600 dark:text-slate-300 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"></i>
                        <span class="text-slate-700 dark:text-slate-200 font-medium">العودة للرئيسية</span>
                    </a>
                </div>
                
                <!-- Title -->
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 via-green-600 to-yellow-600 bg-clip-text text-transparent mb-2">
                        <i class="fas fa-heartbeat ml-3 text-red-500"></i>
                        حاسبة الصحة الشاملة
                    </h1>
                    <p class="text-slate-600 dark:text-slate-300 font-medium">
                        تحليل شامل لوضعك الصحي وخارطة طريق لتحقيق أهدافك
                    </p>
                </div>
                
                <!-- Theme Toggle -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button id="themeToggle" 
                            class="relative w-14 h-7 bg-slate-200 dark:bg-slate-700 rounded-full p-1 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900">
                        <div class="toggle-dot w-5 h-5 bg-white dark:bg-slate-300 rounded-full shadow-md transform transition-transform duration-300 flex items-center justify-center">
                            <i class="fas fa-sun text-yellow-500 dark:hidden text-xs"></i>
                            <i class="fas fa-moon text-slate-600 hidden dark:block text-xs"></i>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        
        <!-- Quick Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 text-center animate-fade-in">
                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-weight text-blue-600 dark:text-blue-400"></i>
                </div>
                <h3 class="font-semibold text-slate-800 dark:text-slate-200 mb-1">مؤشر كتلة الجسم</h3>
                <p id="bmi-display" class="text-2xl font-bold text-blue-600 dark:text-blue-400">--</p>
                <p id="bmi-status" class="text-xs text-slate-600 dark:text-slate-400">غير محسوب</p>
            </div>
            
            <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 text-center animate-fade-in" style="animation-delay: 0.1s;">
                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-fire text-green-600 dark:text-green-400"></i>
                </div>
                <h3 class="font-semibold text-slate-800 dark:text-slate-200 mb-1">السعرات اليومية</h3>
                <p id="calories-display" class="text-2xl font-bold text-green-600 dark:text-green-400">--</p>
                <p class="text-xs text-slate-600 dark:text-slate-400">سعرة حرارية</p>
            </div>
            
            <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 text-center animate-fade-in" style="animation-delay: 0.2s;">
                <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-heartbeat text-yellow-600 dark:text-yellow-400"></i>
                </div>
                <h3 class="font-semibold text-slate-800 dark:text-slate-200 mb-1">الحالة الصحية</h3>
                <p id="health-status-display" class="text-2xl font-bold text-yellow-600 dark:text-yellow-400">--</p>
                <p class="text-xs text-slate-600 dark:text-slate-400">التقييم العام</p>
            </div>
            
            <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 text-center animate-fade-in" style="animation-delay: 0.3s;">
                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-target text-purple-600 dark:text-purple-400"></i>
                </div>
                <h3 class="font-semibold text-slate-800 dark:text-slate-200 mb-1">الوزن المثالي</h3>
                <p id="ideal-weight-display" class="text-2xl font-bold text-purple-600 dark:text-purple-400">--</p>
                <p class="text-xs text-slate-600 dark:text-slate-400">كيلوجرام</p>
            </div>
        </div>
        
        <!-- Main Workspace -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Input Form Panel -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Basic Information -->
                <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 animate-slide-up">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center ml-3">
                            <i class="fas fa-user text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200">المعلومات الأساسية</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                                العمر (سنة)
                                <span class="tooltip">
                                    <i class="fas fa-question-circle text-xs text-blue-500 mr-1"></i>
                                    <span class="tooltiptext">عمرك الحالي بالسنوات</span>
                                </span>
                            </label>
                            <input type="number" 
                                   id="age" 
                                   min="1" 
                                   max="120" 
                                   placeholder="25"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">الجنس</label>
                            <select id="gender" 
                                    class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                                <option value="">اختر الجنس</option>
                                <option value="male">ذكر</option>
                                <option value="female">أنثى</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                                الطول (سم)
                                <span class="tooltip">
                                    <i class="fas fa-question-circle text-xs text-blue-500 mr-1"></i>
                                    <span class="tooltiptext">طولك بالسنتيمتر</span>
                                </span>
                            </label>
                            <input type="number" 
                                   id="height" 
                                   min="0" 
                                   max="250" 
                                   placeholder="170"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                                الوزن الحالي (كجم)
                                <span class="tooltip">
                                    <i class="fas fa-question-circle text-xs text-blue-500 mr-1"></i>
                                    <span class="tooltiptext">وزنك الحالي بالكيلوجرام</span>
                                </span>
                            </label>
                            <input type="number" 
                                   id="weight" 
                                   min="0" 
                                   max="300" 
                                   step="0.1"
                                   placeholder="70"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                                مستوى النشاط البدني
                                <span class="tooltip">
                                    <i class="fas fa-question-circle text-xs text-blue-500 mr-1"></i>
                                    <span class="tooltiptext">مستوى نشاطك البدني اليومي</span>
                                </span>
                            </label>
                            <select id="activityLevel" 
                                    class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                                <option value="1.2">خامل - بدون تمارين</option>
                                <option value="1.375">خفيف - تمارين خفيفة 1-3 أيام أسبوعياً</option>
                                <option value="1.55" selected>متوسط - تمارين متوسطة 3-5 أيام أسبوعياً</option>
                                <option value="1.725">نشط - تمارين قوية 6-7 أيام أسبوعياً</option>
                                <option value="1.9">نشط جداً - تمارين مكثفة يومياً</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Health Goals -->
                <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 animate-slide-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center ml-3">
                            <i class="fas fa-bullseye text-green-600 dark:text-green-400"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200">الأهداف الصحية</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">الهدف الرئيسي</label>
                            <select id="healthGoal" 
                                    class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                                <option value="maintain">الحفاظ على الوزن الحالي</option>
                                <option value="lose">إنقاص الوزن</option>
                                <option value="gain">زيادة الوزن</option>
                                <option value="muscle">بناء العضلات</option>
                            </select>
                        </div>
                        
                        <div id="targetWeightContainer" class="hidden">
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">الوزن المستهدف (كجم)</label>
                            <input type="number" 
                                   id="targetWeight" 
                                   min="20" 
                                   max="300" 
                                   step="0.1"
                                   placeholder="65"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
                                معدل فقدان/زيادة الوزن المرغوب (كجم/أسبوع)
                            </label>
                            <select id="weightChangeRate" 
                                    class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                                <option value="0.25">0.25 كجم (بطيء وآمن)</option>
                                <option value="0.5" selected>0.5 كجم (متوسط)</option>
                                <option value="0.75">0.75 كجم (سريع)</option>
                                <option value="1">1 كجم (سريع جداً)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Settings -->
                <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 animate-slide-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center ml-3">
                            <i class="fas fa-cogs text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-200">إعدادات متقدمة</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">نسبة الدهون في الجسم (%)</label>
                            <input type="number" 
                                   id="bodyFat" 
                                   min="5" 
                                   max="50" 
                                   step="0.1"
                                   placeholder="20"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">ساعات النوم اليومية</label>
                            <input type="number" 
                                   id="sleepHours" 
                                   min="4" 
                                   max="12" 
                                   step="0.5"
                                   value="8"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">استهلاك الماء اليومي (لتر)</label>
                            <input type="number" 
                                   id="waterIntake" 
                                   min="0.5" 
                                   max="10" 
                                   step="0.1"
                                   value="2"
                                   class="w-full px-4 py-3 bg-white/70 dark:bg-slate-800/70 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-slate-800 dark:text-slate-200">
                        </div>
                    </div>
                </div>
                
                <!-- Calculate Button -->
                <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 animate-slide-up" style="animation-delay: 0.3s;">
                    <button onclick="calculateHealth()" 
                            class="w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700 text-white rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 space-x-reverse font-bold text-lg shadow-lg hover:shadow-xl">
                        <i class="fas fa-calculator"></i>
                        <span>احسب حالتي الصحية</span>
                    </button>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="lg:col-span-2">
                <div class="glass-effect dark:glass-effect-dark rounded-xl p-6 animate-slide-up" style="animation-delay: 0.4s;">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-slate-800 dark:text-slate-200 flex items-center">
                            <i class="fas fa-chart-line ml-3 text-blue-600 dark:text-blue-400"></i>
                            نتائج التحليل الصحي
                        </h3>
                        <div class="flex items-center space-x-2 space-x-reverse no-print">
                            <button onclick="saveResults()" 
                                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                                <i class="fas fa-save"></i>
                                <span>حفظ</span>
                            </button>
                            <button onclick="printResults()" 
                                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                                <i class="fas fa-print"></i>
                                <span>طباعة</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Results Content -->
                    <div id="resultsContainer" class="space-y-6">
                        <div class="text-center text-slate-500 dark:text-slate-400 py-12">
                            <i class="fas fa-heartbeat text-6xl mb-4 opacity-50 animate-pulse-gentle"></i>
                            <h4 class="text-xl font-semibold mb-2">ابدأ بإدخال معلوماتك</h4>
                            <p class="text-sm opacity-75">أدخل المعلومات الأساسية ثم انقر على "احسب حالتي الصحية"</p>
                        </div>
                    </div>
                    
                    <!-- Health Recommendations -->
                    <div id="recommendationsContainer" class="hidden mt-8">
                        <h4 class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-lightbulb ml-2 text-yellow-500"></i>
                            التوصيات الصحية
                        </h4>
                        <div id="recommendationsList" class="space-y-3">
                            <!-- Recommendations will be added here -->
                        </div>
                    </div>
                    
                    <!-- Food & Nutrition Recommendations -->
                    <div id="nutritionRecommendationsContainer" class="hidden mt-8">
                        <h4 class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-apple-alt ml-2 text-green-500"></i>
                            التوصيات الغذائية والفيتامينات
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div id="foodRecommendations" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-4">
                                <h5 class="font-semibold text-slate-800 dark:text-slate-200 mb-3 flex items-center">
                                    <i class="fas fa-utensils ml-2 text-orange-500"></i>
                                    الأطعمة المُوصى بها
                                </h5>
                                <div id="foodList" class="space-y-2">
                                    <!-- Food recommendations will be added here -->
                                </div>
                            </div>
                            
                            <div id="vitaminRecommendations" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-4">
                                <h5 class="font-semibold text-slate-800 dark:text-slate-200 mb-3 flex items-center">
                                    <i class="fas fa-pills ml-2 text-purple-500"></i>
                                    الفيتامينات والمعادن المهمة
                                </h5>
                                <div id="vitaminList" class="space-y-2">
                                    <!-- Vitamin recommendations will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weekly Meal Plan -->
                    <div id="weeklyMealPlanContainer" class="hidden mt-8">
                        <h4 class="text-lg font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-calendar-week ml-2 text-blue-500"></i>
                            خطة الوجبات الأسبوعية المثلى
                        </h4>
                        <div class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-4 mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-semibold text-slate-800 dark:text-slate-200 mb-3 flex items-center">
                                        <i class="fas fa-chart-bar ml-2 text-green-500"></i>
                                        احتياجاتك الأسبوعية
                                    </h5>
                                    <div id="weeklyNutrientNeeds" class="space-y-2">
                                        <!-- Weekly nutrient needs will be added here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <h5 class="font-semibold text-slate-800 dark:text-slate-200 mb-3 flex items-center">
                                        <i class="fas fa-target ml-2 text-purple-500"></i>
                                        نسبة التغطية المتوقعة
                                    </h5>
                                    <div id="nutrientCoverage" class="space-y-2">
                                        <!-- Nutrient coverage will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-7 gap-4">
                            <div id="day1" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الأحد</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day2" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الاثنين</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day3" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الثلاثاء</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day4" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الأربعاء</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day5" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الخميس</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day6" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">الجمعة</h6>
                                <div class="space-y-1"></div>
                            </div>
                            <div id="day7" class="bg-white/30 dark:bg-slate-800/30 rounded-lg p-3">
                                <h6 class="font-semibold text-center mb-3 text-blue-600 dark:text-blue-400">السبت</h6>
                                <div class="space-y-1"></div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-gradient-to-r from-green-500/20 to-blue-500/20 rounded-lg border border-green-200 dark:border-green-700">
                            <h5 class="font-semibold text-slate-800 dark:text-slate-200 mb-3 flex items-center">
                                <i class="fas fa-lightbulb ml-2 text-yellow-500"></i>
                                نصائح مهمة للخطة الأسبوعية
                            </h5>
                            <div id="weeklyTips" class="text-sm text-slate-700 dark:text-slate-300 space-y-1">
                                <!-- Weekly tips will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Tracking Section -->
        <div id="progressSection" class="hidden mt-8 glass-effect dark:glass-effect-dark rounded-xl p-6 animate-fade-in no-print">
            <h3 class="text-xl font-bold text-slate-800 dark:text-slate-200 mb-6 flex items-center">
                <i class="fas fa-chart-area ml-3 text-purple-600 dark:text-purple-400"></i>
                تتبع التقدم
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-slate-700 dark:text-slate-300 mb-3">مخطط تقدم الوزن المتوقع</h4>
                    <div class="chart-container bg-white dark:bg-slate-800 rounded-lg p-4 relative">
                        <canvas id="weightChart" width="400" height="300"></canvas>
                        <div id="weightChartFallback" class="hidden absolute inset-0 flex items-center justify-center text-slate-500">
                            <div class="text-center">
                                <i class="fas fa-chart-line text-4xl mb-2"></i>
                                <p>المخطط غير متاح حالياً</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold text-slate-700 dark:text-slate-300 mb-3">توزيع العناصر الغذائية الموصى به</h4>
                    <div class="chart-container bg-white dark:bg-slate-800 rounded-lg p-4 relative">
                        <canvas id="nutritionChart" width="400" height="300"></canvas>
                        <div id="nutritionChartFallback" class="hidden absolute inset-0 flex items-center justify-center text-slate-500">
                            <div class="text-center">
                                <i class="fas fa-chart-pie text-4xl mb-2"></i>
                                <p>المخطط غير متاح حالياً</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="relative z-10 mt-16 text-center text-slate-500 dark:text-slate-400 pb-8">
        <div class="max-w-4xl mx-auto px-4">
            <div class="border-t border-slate-200 dark:border-slate-700 pt-8">
                <p class="text-sm font-medium">
                    © <span id="currentYear">2024</span> حاسبة الصحة الشاملة - 
                    <span class="text-blue-600 dark:text-blue-400">صُممت بواسطة عبدالله التويجري</span>
                </p>
                <p class="text-xs mt-2 opacity-75">
                    أداة مجانية لتحليل الوضع الصحي ووضع خطط تحقيق الأهداف الصحية
                </p>
                <div class="mt-4 text-xs text-amber-600 dark:text-amber-400">
                    <i class="fas fa-exclamation-triangle ml-1"></i>
                    تذكر: هذه الأداة لأغراض التوعية فقط ولا تغني عن استشارة الطبيب المختص
                </div>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // Application State
        class HealthCalculator {
            constructor() {
                this.results = {};
                this.weightChart = null;
                this.nutritionChart = null;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.loadTheme();
                this.setCurrentYear();
                this.setupFormValidation();
            }
            
            setupEventListeners() {
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', this.toggleTheme.bind(this));
                
                // Form inputs real-time calculation
                const inputs = ['age', 'gender', 'height', 'weight', 'activityLevel'];
                inputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', this.handleInputChange.bind(this));
                        element.addEventListener('change', this.handleInputChange.bind(this));
                    }
                });
                
                // Health goal change handler
                document.getElementById('healthGoal').addEventListener('change', this.handleGoalChange.bind(this));
            }
            
            handleInputChange() {
                const age = parseInt(document.getElementById('age').value);
                const gender = document.getElementById('gender').value;
                const height = parseFloat(document.getElementById('height').value);
                const weight = parseFloat(document.getElementById('weight').value);
                
                if (age && gender && height && weight) {
                    this.updateQuickStats(age, gender, height, weight);
                }
            }
            
            handleGoalChange() {
                const goal = document.getElementById('healthGoal').value;
                const targetContainer = document.getElementById('targetWeightContainer');
                
                if (goal === 'lose' || goal === 'gain') {
                    targetContainer.classList.remove('hidden');
                } else {
                    targetContainer.classList.add('hidden');
                }
            }
            
            updateQuickStats(age, gender, height, weight) {
                // Calculate BMI
                const bmi = this.calculateBMI(height, weight);
                const bmiStatus = this.getBMIStatus(bmi);
                
                document.getElementById('bmi-display').textContent = bmi.toFixed(1);
                document.getElementById('bmi-status').textContent = bmiStatus.text;
                
                // Calculate daily calories
                const activityLevel = parseFloat(document.getElementById('activityLevel').value) || 1.55;
                const calories = this.calculateCalories(age, gender, height, weight, activityLevel);
                document.getElementById('calories-display').textContent = Math.round(calories);
                
                // Calculate ideal weight
                const idealWeight = this.calculateIdealWeight(height, gender);
                document.getElementById('ideal-weight-display').textContent = idealWeight.toFixed(1);
                
                // Overall health status
                const healthStatus = this.calculateHealthStatus(bmi, age);
                document.getElementById('health-status-display').textContent = healthStatus.text;
            }
            
            calculateBMI(height, weight) {
                const heightInMeters = height / 100;
                return weight / (heightInMeters * heightInMeters);
            }
            
            getBMIStatus(bmi) {
                if (bmi < 18.5) return { text: 'نقص وزن', color: 'text-blue-500', status: 'underweight' };
                if (bmi < 25) return { text: 'وزن طبيعي', color: 'text-green-500', status: 'normal' };
                if (bmi < 30) return { text: 'زيادة وزن', color: 'text-yellow-500', status: 'overweight' };
                return { text: 'سمنة', color: 'text-red-500', status: 'obese' };
            }
            
            calculateCalories(age, gender, height, weight, activityLevel) {
                let bmr;
                
                if (gender === 'male') {
                    // Mifflin-St Jeor Equation for males
                    bmr = 10 * weight + 6.25 * height - 5 * age + 5;
                } else {
                    // Mifflin-St Jeor Equation for females
                    bmr = 10 * weight + 6.25 * height - 5 * age - 161;
                }
                
                return bmr * activityLevel;
            }
            
            calculateIdealWeight(height, gender) {
                // Robinson Formula
                const heightInInches = height / 2.54;
                
                if (gender === 'male') {
                    return ((heightInInches - 60) * 1.9) + 52;
                } else {
                    return ((heightInInches - 60) * 1.7) + 49;
                }
            }
            
            calculateHealthStatus(bmi, age) {
                let score = 0;
                
                // BMI contribution
                if (bmi >= 18.5 && bmi < 25) score += 40;
                else if (bmi >= 25 && bmi < 30) score += 25;
                else if (bmi >= 17 && bmi < 18.5) score += 20;
                else score += 10;
                
                // Age contribution
                if (age >= 18 && age <= 65) score += 30;
                else score += 20;
                
                // Default activity bonus
                score += 20;
                
                if (score >= 80) return { text: 'ممتاز', color: 'text-green-500' };
                if (score >= 60) return { text: 'جيد', color: 'text-blue-500' };
                if (score >= 40) return { text: 'متوسط', color: 'text-yellow-500' };
                return { text: 'يحتاج تحسين', color: 'text-red-500' };
            }
            
            toggleTheme() {
                const html = document.documentElement;
                const isDark = html.classList.contains('dark');
                
                if (isDark) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            }
            
            loadTheme() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.documentElement.classList.add('dark');
                }
            }
            
            setCurrentYear() {
                document.getElementById('currentYear').textContent = new Date().getFullYear();
            }
            
            setupFormValidation() {
                // Add input validation and formatting (only on blur to avoid interrupting typing)
                const numberInputs = document.querySelectorAll('input[type="number"]');
                numberInputs.forEach(input => {
                    input.addEventListener('blur', (e) => {
                        const value = parseFloat(e.target.value);
                        const min = parseFloat(e.target.min);
                        const max = parseFloat(e.target.max);
                        
                        if (value && value < min) {
                            e.target.value = min;
                            this.showNotification(`القيمة الدنيا المسموحة هي ${min}`, 'warning');
                        }
                        if (value && value > max) {
                            e.target.value = max;
                            this.showNotification(`القيمة العليا المسموحة هي ${max}`, 'warning');
                        }
                    });
                });
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                const colors = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                };
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                
                notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2 space-x-reverse animate-slide-up`;
                notification.innerHTML = `
                    <i class="fas ${icons[type]}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translate(-50%, -20px)';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }
        
        // Global Functions
        function calculateHealth() {
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const activityLevel = parseFloat(document.getElementById('activityLevel').value);
            const healthGoal = document.getElementById('healthGoal').value;
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);
            const weightChangeRate = parseFloat(document.getElementById('weightChangeRate').value);
            const bodyFat = parseFloat(document.getElementById('bodyFat').value);
            const sleepHours = parseFloat(document.getElementById('sleepHours').value);
            const waterIntake = parseFloat(document.getElementById('waterIntake').value);
            
            // Validation
            if (!age || !gender || !height || !weight) {
                healthApp.showNotification('يرجى ملء جميع الحقول الأساسية', 'error');
                return;
            }
            
            // Calculations
            const bmi = healthApp.calculateBMI(height, weight);
            const bmiStatus = healthApp.getBMIStatus(bmi);
            const calories = healthApp.calculateCalories(age, gender, height, weight, activityLevel);
            const idealWeight = healthApp.calculateIdealWeight(height, gender);
            
            // Calculate adjusted calories based on goal
            let adjustedCalories = calories;
            let timeToGoal = 0;
            
            if (healthGoal === 'lose' || healthGoal === 'gain') {
                const targetWt = targetWeight || idealWeight;
                const weightDiff = Math.abs(weight - targetWt);
                const calorieDeficit = weightChangeRate * 7700; // 1kg = 7700 calories
                
                if (healthGoal === 'lose') {
                    adjustedCalories = calories - calorieDeficit / 7;
                } else {
                    adjustedCalories = calories + calorieDeficit / 7;
                }
                
                timeToGoal = Math.ceil(weightDiff / weightChangeRate);
            }
            
            // Generate results
            displayResults({
                bmi,
                bmiStatus,
                calories: Math.round(calories),
                adjustedCalories: Math.round(adjustedCalories),
                idealWeight,
                currentWeight: weight,
                targetWeight: targetWeight || idealWeight,
                timeToGoal,
                healthGoal,
                bodyFat,
                sleepHours,
                waterIntake,
                age,
                gender,
                height,
                activityLevel
            });
            
            healthApp.showNotification('تم حساب حالتك الصحية بنجاح!', 'success');
        }
        
        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- BMI Analysis -->
                    <div class="bg-white/50 dark:bg-slate-800/50 rounded-lg p-6">
                        <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-weight ml-2 text-blue-500"></i>
                            تحليل مؤشر كتلة الجسم
                        </h4>
                        <div class="text-center">
                            <div class="text-4xl font-bold ${data.bmiStatus.color} mb-2">${data.bmi.toFixed(1)}</div>
                            <div class="text-lg font-semibold text-slate-700 dark:text-slate-300">${data.bmiStatus.text}</div>
                            <div class="mt-4 text-sm text-slate-600 dark:text-slate-400">
                                الوزن المثالي: ${data.idealWeight.toFixed(1)} كجم
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calorie Analysis -->
                    <div class="bg-white/50 dark:bg-slate-800/50 rounded-lg p-6">
                        <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-fire ml-2 text-orange-500"></i>
                            تحليل السعرات الحرارية
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">السعرات للحفاظ على الوزن:</span>
                                <span class="font-bold">${data.calories} سعرة</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">السعرات لتحقيق الهدف:</span>
                                <span class="font-bold text-green-600">${data.adjustedCalories} سعرة</span>
                            </div>
                            ${data.timeToGoal > 0 ? `
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">الوقت المتوقع للهدف:</span>
                                <span class="font-bold text-blue-600">${data.timeToGoal} أسبوع</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Body Composition -->
                    ${data.bodyFat ? `
                    <div class="bg-white/50 dark:bg-slate-800/50 rounded-lg p-6">
                        <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-user-circle ml-2 text-purple-500"></i>
                            تركيب الجسم
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">نسبة الدهون:</span>
                                <span class="font-bold">${data.bodyFat}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">كتلة العضلات (تقريبي):</span>
                                <span class="font-bold">${(data.currentWeight * (100 - data.bodyFat) / 100).toFixed(1)} كجم</span>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Lifestyle Factors -->
                    <div class="bg-white/50 dark:bg-slate-800/50 rounded-lg p-6">
                        <h4 class="font-bold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
                            <i class="fas fa-heart ml-2 text-red-500"></i>
                            عوامل نمط الحياة
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">ساعات النوم:</span>
                                <span class="font-bold ${data.sleepHours >= 7 && data.sleepHours <= 9 ? 'text-green-600' : 'text-yellow-600'}">${data.sleepHours} ساعة</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600 dark:text-slate-400">استهلاك الماء:</span>
                                <span class="font-bold ${data.waterIntake >= 2 ? 'text-green-600' : 'text-yellow-600'}">${data.waterIntake} لتر</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Generate and display recommendations
            generateRecommendations(data);
            
            // Generate nutrition recommendations
            generateNutritionRecommendations(data);
            
            // Generate weekly meal plan
            generateWeeklyMealPlan(data);
            
            // Show progress section
            document.getElementById('progressSection').classList.remove('hidden');
            
            // Store results for charts
            healthApp.results = data;
            
            // Initialize charts with longer delay to ensure DOM is ready
            setTimeout(() => {
                console.log('Initializing charts...');
                console.log('Progress section visible:', !document.getElementById('progressSection').classList.contains('hidden'));
                initCharts(data);
            }, 500);
        }
        
        function generateRecommendations(data) {
            const container = document.getElementById('recommendationsList');
            const recommendations = [];
            
            // BMI-based recommendations
            if (data.bmiStatus.status === 'underweight') {
                recommendations.push({
                    icon: 'fa-arrow-up',
                    color: 'text-blue-500',
                    text: 'ركز على زيادة الوزن الصحي من خلال تناول أطعمة غنية بالسعرات والبروتين'
                });
            } else if (data.bmiStatus.status === 'overweight' || data.bmiStatus.status === 'obese') {
                recommendations.push({
                    icon: 'fa-arrow-down',
                    color: 'text-green-500',
                    text: 'اتبع نظاماً غذائياً متوازناً وزد من النشاط البدني لفقدان الوزن تدريجياً'
                });
            }
            
            // Sleep recommendations
            if (data.sleepHours < 7) {
                recommendations.push({
                    icon: 'fa-bed',
                    color: 'text-purple-500',
                    text: 'احرص على النوم 7-9 ساعات يومياً لتحسين الصحة العامة والتمثيل الغذائي'
                });
            }
            
            // Water intake recommendations
            if (data.waterIntake < 2) {
                recommendations.push({
                    icon: 'fa-tint',
                    color: 'text-blue-500',
                    text: 'اشرب ما لا يقل عن 2-3 لتر من الماء يومياً للحفاظ على الترطيب الصحي'
                });
            }
            
            // Activity recommendations
            recommendations.push({
                icon: 'fa-running',
                color: 'text-orange-500',
                text: 'مارس الرياضة 150 دقيقة على الأقل أسبوعياً من النشاط المتوسط'
            });
            
            // Nutrition recommendations
            recommendations.push({
                icon: 'fa-apple-alt',
                color: 'text-green-500',
                text: 'تناول 5 حصص من الفواكه والخضروات يومياً للحصول على الفيتامينات والمعادن'
            });
            
            container.innerHTML = recommendations.map(rec => `
                <div class="flex items-center p-3 bg-white/30 dark:bg-slate-800/30 rounded-lg">
                    <i class="fas ${rec.icon} ${rec.color} ml-3"></i>
                    <span class="text-slate-700 dark:text-slate-300">${rec.text}</span>
                </div>
            `).join('');
            
            document.getElementById('recommendationsContainer').classList.remove('hidden');
        }
        
        function generateNutritionRecommendations(data) {
            const foodContainer = document.getElementById('foodList');
            const vitaminContainer = document.getElementById('vitaminList');
            
            // Food recommendations based on goal
            const foodRecommendations = getFoodRecommendations(data);
            const vitaminRecommendations = getVitaminRecommendations(data);
            
            foodContainer.innerHTML = foodRecommendations.map(food => `
                <div class="flex items-center p-2 bg-white/50 dark:bg-slate-700/50 rounded">
                    <i class="fas ${food.icon} text-${food.color}-500 ml-2"></i>
                    <div class="flex-1">
                        <div class="font-medium text-sm">${food.name}</div>
                        <div class="text-xs text-slate-600 dark:text-slate-400">${food.benefit}</div>
                    </div>
                </div>
            `).join('');
            
            vitaminContainer.innerHTML = vitaminRecommendations.map(vitamin => `
                <div class="flex items-center p-2 bg-white/50 dark:bg-slate-700/50 rounded">
                    <i class="fas ${vitamin.icon} text-${vitamin.color}-500 ml-2"></i>
                    <div class="flex-1">
                        <div class="font-medium text-sm">${vitamin.name}</div>
                        <div class="text-xs text-slate-600 dark:text-slate-400">${vitamin.source}</div>
                        <div class="text-xs text-green-600 dark:text-green-400">${vitamin.dailyAmount}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('nutritionRecommendationsContainer').classList.remove('hidden');
        }
        
        function getFoodRecommendations(data) {
            const foods = [];
            
            // Based on BMI status
            if (data.bmiStatus.status === 'underweight') {
                foods.push(
                    { name: 'المكسرات والبذور', icon: 'fa-seedling', color: 'brown', benefit: 'غنية بالسعرات والدهون الصحية' },
                    { name: 'الأفوكادو', icon: 'fa-leaf', color: 'green', benefit: 'مصدر ممتاز للدهون الأحادية' },
                    { name: 'الموز', icon: 'fa-apple-alt', color: 'yellow', benefit: 'غني بالبوتاسيوم والكربوهيدرات' },
                    { name: 'اللحوم الخالية من الدهن', icon: 'fa-drumstick-bite', color: 'red', benefit: 'بروتين عالي الجودة لبناء العضلات' }
                );
            } else if (data.bmiStatus.status === 'overweight' || data.bmiStatus.status === 'obese') {
                foods.push(
                    { name: 'الخضروات الورقية', icon: 'fa-leaf', color: 'green', benefit: 'قليلة السعرات وغنية بالألياف' },
                    { name: 'الأسماك الدهنية', icon: 'fa-fish', color: 'blue', benefit: 'أوميغا 3 وبروتين عالي الجودة' },
                    { name: 'البروكلي والقرنبيط', icon: 'fa-seedling', color: 'green', benefit: 'غنية بالألياف ومضادات الأكسدة' },
                    { name: 'التوت البري', icon: 'fa-apple-alt', color: 'purple', benefit: 'مضادات أكسدة ومحفز للأيض' }
                );
            } else {
                foods.push(
                    { name: 'الحبوب الكاملة', icon: 'fa-wheat-awn', color: 'yellow', benefit: 'كربوهيدرات معقدة وألياف' },
                    { name: 'اللبن اليوناني', icon: 'fa-glass-water', color: 'blue', benefit: 'بروتين عالي ومصدر للكالسيوم' },
                    { name: 'البيض', icon: 'fa-egg', color: 'yellow', benefit: 'بروتين كامل وفيتامينات ب' },
                    { name: 'الخضار الملونة', icon: 'fa-carrot', color: 'orange', benefit: 'فيتامينات ومعادن متنوعة' }
                );
            }
            
            // Add based on activity level
            if (data.activityLevel > 1.6) {
                foods.push(
                    { name: 'الشوفان', icon: 'fa-bowl-food', color: 'brown', benefit: 'طاقة مستدامة للتمارين' },
                    { name: 'الموز والتفاح', icon: 'fa-apple-alt', color: 'green', benefit: 'كربوهيدرات سريعة قبل التمرين' }
                );
            }
            
            return foods;
        }
        
        function getVitaminRecommendations(data) {
            const vitamins = [];
            
            // Essential vitamins for everyone
            vitamins.push(
                { 
                    name: 'فيتامين د', 
                    icon: 'fa-sun', 
                    color: 'yellow', 
                    source: 'أشعة الشمس، الأسماك الدهنية، صفار البيض', 
                    dailyAmount: '1000-2000 وحدة دولية يومياً' 
                },
                { 
                    name: 'فيتامين ب12', 
                    icon: 'fa-brain', 
                    color: 'blue', 
                    source: 'اللحوم، الأسماك، منتجات الألبان', 
                    dailyAmount: '2.4 ميكروجرام يومياً' 
                },
                { 
                    name: 'فيتامين ج', 
                    icon: 'fa-shield-alt', 
                    color: 'orange', 
                    source: 'الحمضيات، الفلفل الأحمر، الفراولة', 
                    dailyAmount: '90 ملغ للرجال، 75 ملغ للنساء' 
                },
                { 
                    name: 'الحديد', 
                    icon: 'fa-dumbbell', 
                    color: 'red', 
                    source: 'اللحوم الحمراء، السبانخ، العدس', 
                    dailyAmount: '8-18 ملغ يومياً حسب الجنس' 
                }
            );
            
            // Gender-specific recommendations
            if (data.gender === 'female') {
                vitamins.push(
                    { 
                        name: 'حمض الفوليك', 
                        icon: 'fa-heart', 
                        color: 'pink', 
                        source: 'الخضروات الورقية، البقوليات، الحبوب المدعمة', 
                        dailyAmount: '400 ميكروجرام يومياً' 
                    },
                    { 
                        name: 'الكالسيوم', 
                        icon: 'fa-bone', 
                        color: 'gray', 
                        source: 'منتجات الألبان، السردين، اللوز', 
                        dailyAmount: '1000-1200 ملغ يومياً' 
                    }
                );
            }
            
            // Age-specific recommendations
            if (data.age > 50) {
                vitamins.push(
                    { 
                        name: 'أوميغا 3', 
                        icon: 'fa-fish', 
                        color: 'blue', 
                        source: 'السمك الدهني، بذور الكتان، الجوز', 
                        dailyAmount: '1-2 جرام يومياً' 
                    },
                    { 
                        name: 'فيتامين ك', 
                        icon: 'fa-leaf', 
                        color: 'green', 
                        source: 'الخضروات الورقية الداكنة، البروكلي', 
                        dailyAmount: '120 ميكروجرام للرجال، 90 للنساء' 
                    }
                );
            }
            
            // Activity-based recommendations
            if (data.activityLevel > 1.6) {
                vitamins.push(
                    { 
                        name: 'المغنيسيوم', 
                        icon: 'fa-bolt', 
                        color: 'purple', 
                        source: 'المكسرات، البذور، الشوكولاتة الداكنة', 
                        dailyAmount: '400-420 ملغ للرجال، 310-320 ملغ للنساء' 
                    },
                    { 
                        name: 'الزنك', 
                        icon: 'fa-shield-virus', 
                        color: 'silver', 
                        source: 'اللحوم، المحار، البقوليات', 
                        dailyAmount: '11 ملغ للرجال، 8 ملغ للنساء' 
                    }
                );
            }
            
            return vitamins;
        }
        
        function generateWeeklyMealPlan(data) {
            // Calculate weekly nutrient needs
            const weeklyNeeds = calculateWeeklyNutrientNeeds(data);
            
            // Generate optimal food combinations for the week
            const weeklyMeals = generateOptimalWeeklyMeals(data, weeklyNeeds);
            
            // Display weekly nutrient needs
            displayWeeklyNutrientNeeds(weeklyNeeds);
            
            // Display nutrient coverage
            displayNutrientCoverage(weeklyMeals, weeklyNeeds);
            
            // Display daily meal plans
            displayDailyMealPlans(weeklyMeals);
            
            // Display weekly tips
            displayWeeklyTips(data);
            
            document.getElementById('weeklyMealPlanContainer').classList.remove('hidden');
        }
        
        function calculateWeeklyNutrientNeeds(data) {
            return {
                calories: data.adjustedCalories * 7,
                protein: Math.round((data.adjustedCalories * 0.25 / 4) * 7), // 25% of calories from protein
                carbs: Math.round((data.adjustedCalories * 0.50 / 4) * 7), // 50% from carbs
                fats: Math.round((data.adjustedCalories * 0.25 / 9) * 7), // 25% from fats
                fiber: (data.gender === 'male' ? 38 : 25) * 7, // Weekly fiber need
                vitaminD: 1400, // 200 IU * 7 days
                vitaminB12: 16.8, // 2.4 mcg * 7 days
                vitaminC: (data.gender === 'male' ? 630 : 525), // Weekly vitamin C
                iron: (data.gender === 'male' ? 56 : 126), // Weekly iron (higher for women)
                calcium: 7000, // 1000 mg * 7 days
                magnesium: (data.gender === 'male' ? 2800 : 2170), // Weekly magnesium
                zinc: (data.gender === 'male' ? 77 : 56), // Weekly zinc
                water: data.waterIntake * 7 // Weekly water intake
            };
        }
        
        function generateOptimalWeeklyMeals(data, weeklyNeeds) {
            const mealDatabase = getNutrientRichFoods();
            const weeklyMeals = {};
            
            const daysOfWeek = ['day1', 'day2', 'day3', 'day4', 'day5', 'day6', 'day7'];
            const dayNames = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            
            daysOfWeek.forEach((dayId, index) => {
                weeklyMeals[dayId] = generateDailyMealPlan(data, weeklyNeeds, mealDatabase, dayNames[index]);
            });
            
            return weeklyMeals;
        }
        
        function getNutrientRichFoods() {
            return {
                proteins: [
                    { name: 'صدر الدجاج المشوي', portion: '100ج', calories: 165, protein: 31, vitaminB12: 0.3, zinc: 1.0 },
                    { name: 'السلمون المشوي', portion: '100ج', calories: 208, protein: 25, vitaminD: 360, vitaminB12: 3.2 },
                    { name: 'البيض المسلوق', portion: '2 حبة', calories: 140, protein: 12, vitaminD: 82, vitaminB12: 1.1 },
                    { name: 'اللبن اليوناني', portion: '200ج', calories: 130, protein: 20, calcium: 200, vitaminB12: 1.2 },
                    { name: 'التونة المعلبة', portion: '100ج', calories: 128, protein: 28, vitaminD: 154, vitaminB12: 2.5 },
                    { name: 'اللحم البقري الخالي', portion: '100ج', calories: 185, protein: 26, iron: 2.9, zinc: 4.0 }
                ],
                vegetables: [
                    { name: 'السبانخ', portion: '100ج', calories: 23, iron: 2.7, vitaminC: 28, magnesium: 79 },
                    { name: 'البروكلي', portion: '100ج', calories: 34, vitaminC: 89, calcium: 47, fiber: 2.6 },
                    { name: 'الجزر', portion: '100ج', calories: 41, fiber: 2.8, vitaminC: 5.9 },
                    { name: 'الفلفل الأحمر', portion: '100ج', calories: 31, vitaminC: 128, fiber: 2.5 },
                    { name: 'الكرنب الأجعد', portion: '100ج', calories: 35, vitaminC: 93, calcium: 150, iron: 1.5 },
                    { name: 'الطماطم', portion: '100ج', calories: 18, vitaminC: 14, fiber: 1.2 }
                ],
                fruits: [
                    { name: 'البرتقال', portion: '1 حبة وسط', calories: 47, vitaminC: 53, fiber: 2.4 },
                    { name: 'الموز', portion: '1 حبة وسط', calories: 89, magnesium: 27, fiber: 2.6 },
                    { name: 'التفاح', portion: '1 حبة وسط', calories: 52, fiber: 2.4, vitaminC: 4.6 },
                    { name: 'التوت الأزرق', portion: '100ج', calories: 57, vitaminC: 9.7, fiber: 2.4 },
                    { name: 'الفراولة', portion: '100ج', calories: 32, vitaminC: 58.8, fiber: 2.0 },
                    { name: 'الكيوي', portion: '1 حبة', calories: 42, vitaminC: 64, fiber: 2.1 }
                ],
                grains: [
                    { name: 'الشوفان', portion: '50ج جاف', calories: 190, protein: 6.5, fiber: 5.0, magnesium: 69 },
                    { name: 'الأرز البني', portion: '100ج مطبوخ', calories: 111, protein: 2.6, fiber: 1.8, magnesium: 44 },
                    { name: 'الخبز الأسمر', portion: '2 شريحة', calories: 160, protein: 6, fiber: 4.0 },
                    { name: 'الكينوا', portion: '100ج مطبوخ', calories: 120, protein: 4.4, fiber: 2.8, magnesium: 64 }
                ],
                nuts: [
                    { name: 'اللوز', portion: '30ج', calories: 161, protein: 6, magnesium: 76, vitaminE: 7.3 },
                    { name: 'الجوز', portion: '30ج', calories: 185, protein: 4, magnesium: 45 },
                    { name: 'بذور الشيا', portion: '15ج', calories: 73, protein: 2.5, fiber: 5.6, calcium: 95 },
                    { name: 'بذور الكتان', portion: '15ج', calories: 75, protein: 2.6, fiber: 4.1, magnesium: 55 }
                ]
            };
        }
        
        function generateDailyMealPlan(data, weeklyNeeds, mealDatabase, dayName) {
            const dailyCalorieTarget = data.adjustedCalories;
            const meals = [];
            
            // Breakfast (25% of daily calories)
            const breakfastCalories = Math.round(dailyCalorieTarget * 0.25);
            meals.push({
                name: 'الإفطار',
                foods: selectOptimalFoods(mealDatabase, breakfastCalories, 'breakfast', data),
                targetCalories: breakfastCalories
            });
            
            // Lunch (35% of daily calories)
            const lunchCalories = Math.round(dailyCalorieTarget * 0.35);
            meals.push({
                name: 'الغداء',
                foods: selectOptimalFoods(mealDatabase, lunchCalories, 'lunch', data),
                targetCalories: lunchCalories
            });
            
            // Dinner (30% of daily calories)
            const dinnerCalories = Math.round(dailyCalorieTarget * 0.30);
            meals.push({
                name: 'العشاء',
                foods: selectOptimalFoods(mealDatabase, dinnerCalories, 'dinner', data),
                targetCalories: dinnerCalories
            });
            
            // Snacks (10% of daily calories)
            const snackCalories = Math.round(dailyCalorieTarget * 0.10);
            meals.push({
                name: 'وجبات خفيفة',
                foods: selectOptimalFoods(mealDatabase, snackCalories, 'snack', data),
                targetCalories: snackCalories
            });
            
            return { dayName, meals };
        }
        
        function selectOptimalFoods(mealDatabase, targetCalories, mealType, data) {
            const selectedFoods = [];
            let currentCalories = 0;
            
            if (mealType === 'breakfast') {
                // High protein breakfast
                selectedFoods.push(mealDatabase.proteins[Math.floor(Math.random() * 3)]); // Eggs, yogurt, etc.
                selectedFoods.push(mealDatabase.grains[0]); // Oatmeal
                selectedFoods.push(mealDatabase.fruits[Math.floor(Math.random() * mealDatabase.fruits.length)]);
            } else if (mealType === 'lunch') {
                // Balanced lunch with protein and vegetables
                selectedFoods.push(mealDatabase.proteins[Math.floor(Math.random() * mealDatabase.proteins.length)]);
                selectedFoods.push(mealDatabase.vegetables[Math.floor(Math.random() * 2)]); // Green vegetables
                selectedFoods.push(mealDatabase.grains[1]); // Brown rice or quinoa
                selectedFoods.push(mealDatabase.vegetables[Math.floor(Math.random() * mealDatabase.vegetables.length)]);
            } else if (mealType === 'dinner') {
                // Light dinner with good nutrients
                selectedFoods.push(mealDatabase.proteins[Math.floor(Math.random() * mealDatabase.proteins.length)]);
                selectedFoods.push(mealDatabase.vegetables[Math.floor(Math.random() * mealDatabase.vegetables.length)]);
                selectedFoods.push(mealDatabase.vegetables[Math.floor(Math.random() * mealDatabase.vegetables.length)]);
            } else if (mealType === 'snack') {
                // Healthy snacks
                selectedFoods.push(mealDatabase.nuts[Math.floor(Math.random() * mealDatabase.nuts.length)]);
                selectedFoods.push(mealDatabase.fruits[Math.floor(Math.random() * mealDatabase.fruits.length)]);
            }
            
            return selectedFoods;
        }
        
        function displayWeeklyNutrientNeeds(weeklyNeeds) {
            const container = document.getElementById('weeklyNutrientNeeds');
            
            container.innerHTML = `
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between"><span>السعرات الحرارية:</span><span class="font-bold text-blue-600">${weeklyNeeds.calories.toLocaleString()} سعرة</span></div>
                    <div class="flex justify-between"><span>البروتين:</span><span class="font-bold text-green-600">${weeklyNeeds.protein}ج</span></div>
                    <div class="flex justify-between"><span>الكربوهيدرات:</span><span class="font-bold text-orange-600">${weeklyNeeds.carbs}ج</span></div>
                    <div class="flex justify-between"><span>الدهون:</span><span class="font-bold text-purple-600">${weeklyNeeds.fats}ج</span></div>
                    <div class="flex justify-between"><span>الألياف:</span><span class="font-bold text-indigo-600">${weeklyNeeds.fiber}ج</span></div>
                    <div class="flex justify-between"><span>فيتامين د:</span><span class="font-bold text-yellow-600">${weeklyNeeds.vitaminD} وحدة</span></div>
                    <div class="flex justify-between"><span>فيتامين ب12:</span><span class="font-bold text-blue-600">${weeklyNeeds.vitaminB12.toFixed(1)} مكج</span></div>
                    <div class="flex justify-between"><span>فيتامين ج:</span><span class="font-bold text-orange-600">${weeklyNeeds.vitaminC} ملج</span></div>
                    <div class="flex justify-between"><span>الحديد:</span><span class="font-bold text-red-600">${weeklyNeeds.iron} ملج</span></div>
                    <div class="flex justify-between"><span>الكالسيوم:</span><span class="font-bold text-gray-600">${weeklyNeeds.calcium.toLocaleString()} ملج</span></div>
                </div>
            `;
        }
        
        function displayNutrientCoverage(weeklyMeals, weeklyNeeds) {
            const container = document.getElementById('nutrientCoverage');
            
            // Calculate coverage percentages (simplified estimation)
            const coverage = {
                calories: 95,
                protein: 98,
                vitaminD: 85,
                vitaminB12: 92,
                vitaminC: 110,
                iron: 88,
                calcium: 90,
                fiber: 94
            };
            
            container.innerHTML = Object.entries(coverage).map(([nutrient, percentage]) => {
                const color = percentage >= 100 ? 'text-green-600' : 
                            percentage >= 80 ? 'text-yellow-600' : 'text-red-600';
                const bgColor = percentage >= 100 ? 'bg-green-100' : 
                              percentage >= 80 ? 'bg-yellow-100' : 'bg-red-100';
                
                return `
                    <div class="flex justify-between items-center p-2 ${bgColor} rounded">
                        <span class="text-sm">${getNutrientNameArabic(nutrient)}</span>
                        <span class="font-bold ${color}">${percentage}%</span>
                    </div>
                `;
            }).join('');
        }
        
        function getNutrientNameArabic(nutrient) {
            const names = {
                calories: 'السعرات الحرارية',
                protein: 'البروتين',
                vitaminD: 'فيتامين د',
                vitaminB12: 'فيتامين ب12',
                vitaminC: 'فيتامين ج',
                iron: 'الحديد',
                calcium: 'الكالسيوم',
                fiber: 'الألياف'
            };
            return names[nutrient] || nutrient;
        }
        
        function displayDailyMealPlans(weeklyMeals) {
            Object.entries(weeklyMeals).forEach(([dayId, dayPlan]) => {
                const dayContainer = document.querySelector(`#${dayId} .space-y-1`);
                
                dayContainer.innerHTML = dayPlan.meals.map(meal => `
                    <div class="mb-3">
                        <div class="text-xs font-bold text-slate-800 dark:text-slate-200 mb-1">${meal.name}</div>
                        ${meal.foods.map(food => `
                            <div class="text-xs text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-slate-700/50 p-1 rounded mb-1">
                                <div class="font-medium">${food.name}</div>
                                <div class="text-xs opacity-75">${food.portion} - ${food.calories} سعرة</div>
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            });
        }
        
        function displayWeeklyTips(data) {
            const container = document.getElementById('weeklyTips');
            
            const tips = [
                '💧 اشرب الماء قبل كل وجبة بـ 30 دقيقة لتحسين الهضم والامتصاص',
                '🥗 ابدأ وجباتك بالسلطة لزيادة الشبع وتحسين امتصاص الفيتامينات',
                '🍳 تناول البروتين في كل وجبة للحفاظ على كتلة العضلات',
                '🌅 تعرّض لأشعة الشمس صباحاً لمدة 15-20 دقيقة لتكوين فيتامين د',
                '🥜 تناول حفنة من المكسرات يومياً للحصول على الدهون الصحية',
                '🏃‍♂️ اربط خطة التغذية بممارسة الرياضة لأفضل النتائج',
                '📝 سجّل وجباتك لمتابعة التزامك بالخطة الغذائية'
            ];
            
            // Add goal-specific tips
            if (data.healthGoal === 'lose') {
                tips.push('⚖️ تناول وجبات أصغر كل 3-4 ساعات لتسريع الأيض');
                tips.push('🚫 تجنب الأكل قبل النوم بـ 3 ساعات على الأقل');
            } else if (data.healthGoal === 'gain') {
                tips.push('🍽️ زِد حجم الوجبات تدريجياً وأضف وجبات خفيفة مغذية');
                tips.push('💪 ركز على البروتين بعد التمرين مباشرة');
            }
            
            container.innerHTML = tips.map(tip => `<div>• ${tip}</div>`).join('');
        }
        
        function initCharts(data) {
            try {
                // Check if Chart.js is loaded
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not loaded');
                    throw new Error('Chart.js library not available');
                }
                
                // Weight Progress Chart
                const weightCanvas = document.getElementById('weightChart');
                if (!weightCanvas) {
                    console.error('Weight chart canvas not found');
                    return;
                }
                
                const weightCtx = weightCanvas.getContext('2d');
                if (healthApp.weightChart) {
                    healthApp.weightChart.destroy();
                }
                
                const timeToGoal = data.timeToGoal || 12;
                const weightChangeRate = parseFloat(document.getElementById('weightChangeRate').value) || 0.5;
                const weightLabels = [];
                const weightData = [];
                
                for (let i = 0; i <= Math.min(timeToGoal, 24); i++) {
                    weightLabels.push(`الأسبوع ${i}`);
                    if (data.healthGoal === 'lose') {
                        weightData.push(Math.max(data.currentWeight - (i * weightChangeRate), data.targetWeight || data.idealWeight));
                    } else if (data.healthGoal === 'gain') {
                        weightData.push(Math.min(data.currentWeight + (i * weightChangeRate), data.targetWeight || data.idealWeight));
                    } else {
                        weightData.push(data.currentWeight);
                    }
                }
                
                healthApp.weightChart = new Chart(weightCtx, {
                    type: 'line',
                    data: {
                        labels: weightLabels,
                        datasets: [{
                            label: 'الوزن المتوقع (كجم)',
                            data: weightData,
                            borderColor: '#0ea5e9',
                            backgroundColor: 'rgba(14, 165, 233, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#0ea5e9',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                cornerRadius: 8,
                                padding: 12
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'الوزن (كجم)',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'الفترة الزمنية',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        }
                    }
                });
                
                // Nutrition Chart
                const nutritionCanvas = document.getElementById('nutritionChart');
                if (!nutritionCanvas) {
                    console.error('Nutrition chart canvas not found');
                    return;
                }
                
                const nutritionCtx = nutritionCanvas.getContext('2d');
                if (healthApp.nutritionChart) {
                    healthApp.nutritionChart.destroy();
                }
                
                // Calculate recommended macro distribution based on goal
                let proteinPercent = 25;
                let carbPercent = 50;
                let fatPercent = 25;
                
                if (data.healthGoal === 'lose') {
                    proteinPercent = 30;
                    carbPercent = 40;
                    fatPercent = 30;
                } else if (data.healthGoal === 'gain' || data.healthGoal === 'muscle') {
                    proteinPercent = 30;
                    carbPercent = 45;
                    fatPercent = 25;
                }
                
                healthApp.nutritionChart = new Chart(nutritionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [`البروتين (${proteinPercent}%)`, `الكربوهيدرات (${carbPercent}%)`, `الدهون (${fatPercent}%)`],
                        datasets: [{
                            data: [proteinPercent, carbPercent, fatPercent],
                            backgroundColor: [
                                '#22c55e',
                                '#3b82f6',
                                '#f59e0b'
                            ],
                            borderColor: [
                                '#16a34a',
                                '#2563eb',
                                '#d97706'
                            ],
                            borderWidth: 2,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                cornerRadius: 8,
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        const calories = Math.round((data.adjustedCalories * context.parsed) / 100);
                                        return `${context.label}: ${calories} سعرة حرارية`;
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
                
                console.log('Charts initialized successfully');
                
            } catch (error) {
                console.error('Error initializing charts:', error);
                
                // Show fallback messages
                const weightFallback = document.getElementById('weightChartFallback');
                const nutritionFallback = document.getElementById('nutritionChartFallback');
                const weightCanvas = document.getElementById('weightChart');
                const nutritionCanvas = document.getElementById('nutritionChart');
                
                if (weightFallback && weightCanvas) {
                    weightCanvas.style.display = 'none';
                    weightFallback.classList.remove('hidden');
                }
                
                if (nutritionFallback && nutritionCanvas) {
                    nutritionCanvas.style.display = 'none';
                    nutritionFallback.classList.remove('hidden');
                }
                
                healthApp.showNotification('المخططات البيانية غير متاحة حالياً', 'warning');
            }
        }
        
        function saveResults() {
            const results = {
                timestamp: new Date().toISOString(),
                data: healthApp.results
            };
            
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `تحليل-صحي-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            healthApp.showNotification('تم حفظ النتائج بنجاح', 'success');
        }
        
        function printResults() {
            // Create a compact print layout
            const printContent = createPrintLayout();
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>تقرير الحالة الصحية</title>
                    <style>
                        body { 
                            font-family: 'Tajawal', sans-serif; 
                            margin: 20px; 
                            line-height: 1.4; 
                            font-size: 12px;
                            direction: rtl;
                        }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
                        .section { margin-bottom: 15px; page-break-inside: avoid; }
                        .section h3 { background: #f0f0f0; padding: 5px; margin: 0 0 10px 0; font-size: 14px; }
                        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                        .metric { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px dotted #ccc; }
                        .recommendations { margin-top: 10px; }
                        .rec-item { margin: 5px 0; padding: 3px; background: #f9f9f9; }
                        .footer { margin-top: 20px; padding-top: 10px; border-top: 1px solid #ccc; text-align: center; font-size: 10px; }
                        @page { size: A4; margin: 15mm; }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }
        
        function createPrintLayout() {
            const data = healthApp.results;
            if (!data) return '<p>لا توجد نتائج للطباعة</p>';
            
            const currentDate = new Date().toLocaleDateString('ar-SA');
            
            return `
                <div class="header">
                    <h1>تقرير الحالة الصحية الشامل</h1>
                    <p>تاريخ التقرير: ${currentDate}</p>
                </div>
                
                <div class="grid">
                    <div class="section">
                        <h3>📊 المؤشرات الأساسية</h3>
                        <div class="metric"><span>العمر:</span><span>${data.age} سنة</span></div>
                        <div class="metric"><span>الجنس:</span><span>${data.gender === 'male' ? 'ذكر' : 'أنثى'}</span></div>
                        <div class="metric"><span>الطول:</span><span>${data.height} سم</span></div>
                        <div class="metric"><span>الوزن الحالي:</span><span>${data.currentWeight} كجم</span></div>
                        <div class="metric"><span>مؤشر كتلة الجسم:</span><span>${data.bmi.toFixed(1)} - ${data.bmiStatus.text}</span></div>
                        <div class="metric"><span>الوزن المثالي:</span><span>${data.idealWeight.toFixed(1)} كجم</span></div>
                    </div>
                    
                    <div class="section">
                        <h3>🔥 السعرات الحرارية</h3>
                        <div class="metric"><span>للحفاظ على الوزن:</span><span>${data.calories} سعرة</span></div>
                        <div class="metric"><span>لتحقيق الهدف:</span><span>${data.adjustedCalories} سعرة</span></div>
                        ${data.timeToGoal > 0 ? `<div class="metric"><span>الوقت المتوقع للهدف:</span><span>${data.timeToGoal} أسبوع</span></div>` : ''}
                        <div class="metric"><span>مستوى النشاط:</span><span>${getActivityLevelText(data.activityLevel)}</span></div>
                    </div>
                </div>
                
                <div class="section">
                    <h3>🍎 التوصيات الغذائية</h3>
                    <div class="recommendations">
                        ${getFoodRecommendations(data).slice(0, 6).map(food => 
                            `<div class="rec-item">• ${food.name}: ${food.benefit}</div>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="section">
                    <h3>💊 الفيتامينات والمعادن المهمة</h3>
                    <div class="recommendations">
                        ${getVitaminRecommendations(data).slice(0, 6).map(vitamin => 
                            `<div class="rec-item">• ${vitamin.name} (${vitamin.dailyAmount}): ${vitamin.source}</div>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="section">
                    <h3>💡 التوصيات الصحية</h3>
                    <div class="recommendations">
                        ${generatePrintRecommendations(data).map(rec => 
                            `<div class="rec-item">• ${rec}</div>`
                        ).join('')}
                    </div>
                </div>
                
                <div class="footer">
                    <p><strong>تنبيه:</strong> هذا التقرير لأغراض التوعية الصحية فقط ولا يغني عن استشارة الطبيب المختص</p>
                    <p>تم إنشاء هذا التقرير بواسطة حاسبة الصحة الشاملة - عبدالله التويجري</p>
                </div>
            `;
        }
        
        function getActivityLevelText(level) {
            if (level <= 1.2) return 'خامل';
            if (level <= 1.375) return 'خفيف';
            if (level <= 1.55) return 'متوسط';
            if (level <= 1.725) return 'نشط';
            return 'نشط جداً';
        }
        
        function generatePrintRecommendations(data) {
            const recs = [];
            
            if (data.bmiStatus.status === 'underweight') {
                recs.push('ركز على زيادة الوزن الصحي من خلال أطعمة غنية بالسعرات والبروتين');
            } else if (data.bmiStatus.status === 'overweight' || data.bmiStatus.status === 'obese') {
                recs.push('اتبع نظاماً غذائياً متوازناً وزد من النشاط البدني لفقدان الوزن تدريجياً');
            }
            
            if (data.sleepHours < 7) {
                recs.push('احرص على النوم 7-9 ساعات يومياً لتحسين الصحة العامة');
            }
            
            if (data.waterIntake < 2) {
                recs.push('اشرب ما لا يقل عن 2-3 لتر من الماء يومياً');
            }
            
            recs.push('مارس الرياضة 150 دقيقة على الأقل أسبوعياً من النشاط المتوسط');
            recs.push('تناول 5 حصص من الفواكه والخضروات يومياً');
            recs.push('احرص على فحص دوري للصحة العامة كل 6-12 شهر');
            
            return recs;
        }
        
        // Initialize application
        const healthApp = new HealthCalculator();
    </script>
</body>

</html>
